#+TITLE: Emacs configuration file
#+AUTHOR: Auralcat
#+DATE: 2017:05:17

* Environment Customizations
#+BEGIN_SRC emacs-lisp
;; A small performance improvement
(setq redisplay-dont-pause t)

;; Store all backups in a specific folder:
(setq backup-directory-alist `(("." . "~/file-bouncer/emacs-backups")))

;; Manual packages load path
(add-to-list 'load-path "~/my-dotfiles/.emacs.d/manual-packages/ob-elixir/")
(add-to-list 'load-path "~/my-dotfiles/.emacs.d/manual-packages/emacs-solargraph/")

;; Backup files by copying them
(setq backup-by-copying t)

;; Save my desktop
(desktop-save-mode 1)

;; I'm too lazy to type "yes" or "no"
(fset 'yes-or-no-p 'y-or-n-p)

;; Clean whitespace before saving a file
(add-hook 'before-save-hook (quote whitespace-cleanup))

;; Enable ido-mode (fewer keystrokes to switch buffers!)
(ido-mode 1)

;; ido-mode in the minibuffer
(icomplete-mode 1)

;; Enable windmove (switch windows with Shift+Arrow keys)
(when (fboundp 'windmove-default-keybindings)
    (windmove-default-keybindings))

;; Replace the built-in buffer menu with ibuffer
(global-set-key [24 2] (quote ibuffer))

;; Prevent the scratch buffer from being killed
(with-current-buffer "*scratch*"
    (emacs-lock-mode 'kill))

;; Set default font for Emacs
(set-frame-font "Ubuntu Mono 12")

;; Enable auto-revert-mode
(global-auto-revert-mode t)

;; Remove the menu bar in terminal mode
(when (not (display-graphic-p))
  (menu-bar-mode -1))

;; Org-babel - load ob-elixir
(load "ob-elixir")

;; Org-babel - load languages
(org-babel-do-load-languages
 'org-babel-load-languages
 '(
   (sh . t)
   (python . t)
   (ruby . t)
   (elixir . t)
   (plantuml . t)
   (dot . t)
   ))

;; Use Bash as default shell interpreter
(setq org-babel-sh-command "/bin/bash")

;; Activate Company mode
(add-hook 'after-init-hook 'global-company-mode)

;; Enable global Abbrev mode
(setq-default abbrev-mode t)

#+END_SRC
* Hooks
#+BEGIN_SRC emacs-lisp
;; General programming mode
(defun set-programming-tweaks ()
    (linum-mode 1)
    (column-number-mode 1))

;; Prog-mode is from where all the programming modes are derived from.
;; This means that if you call prog-mode-hook, the settings will be
;; applied to ALL programming modes in Emacs.
(add-hook 'prog-mode-hook (quote set-programming-tweaks))

;; Ruby
;; Activate ruby-tools
(add-hook 'enh-ruby-mode-hook (quote ruby-tools-mode))

;; Create filling for org-mode
(add-hook 'org-mode-hook 'auto-fill-mode)
#+END_SRC
* IRC
Qui Nov  2 19:57:06 BRST 2017 - Tried using IRC inside Emacs, didn't please
me, too many buffers to work with... for now.
#+BEGIN_SRC emacs-lisp
;; Use Weechat from Emacs
(require-package 'weechat)
;; Bind M-p to switch to previous buffer
#+END_SRC
* Custom functions
#+BEGIN_SRC emacs-lisp
;; Recreate scratch buffer
(defun create-scratch-buffer ()
  "create a scratch buffer"
  (interactive)
  (switch-to-buffer (get-buffer-create "*scratch*"))
  (org-mode)
  (insert initial-scratch-message)
  ;; Prevent the scratch buffer from being killed
  (with-current-buffer "*scratch*"
      (emacs-lock-mode 'kill)))

;; Unfill region, AKA leave single huge line
(defun unfill-region (beg end)
  "Unfill the region, joining text paragraphs into a single
  logical line.  This is useful, e.g., for use with
  `visual-line-mode'."
  (interactive "*r")
    (let ((fill-column (point-max)))
      (fill-region beg end)))

;; Call the live page reload script from within Emacs and bind it to a key
;; (defun css-live-reload-current-webpage ()
;;     (when (and (stringp buffer-file-name)
;;       (string-match "\\.scss\\'" buffer-file-name))
;;     (shell-command "~/my-dotfiles/bash/live-reload-firefox.sh")))

;; The original idea is to call this function when saving a stylesheet
;; (add-hook 'after-save-hook 'css-live-reload-current-webpage)

#+END_SRC
* Function Aliases
#+BEGIN_SRC emacs-lisp
;; This is how you define aliases for Elisp functions
(defalias 'plp 'package-list-packages)
#+END_SRC
* Packages
** Projectile
   Manage projects in Emacs.
   #+BEGIN_SRC emacs-lisp
   (use-package projectile)
   ;; Enable it globally.
   (add-hook 'after-init-hook #'projectile-global-mode)
   #+END_SRC
** Autopair
  Automatically pair braces and quotes like in TextMate
  #+BEGIN_SRC emacs-lisp
  (use-package autopair
     :init (autopair-global-mode))
  #+END_SRC
** Emmet-mode
   #+BEGIN_SRC emacs-lisp
   (use-package emmet-mode)
   #+END_SRC
** Sass-mode
   #+BEGIN_SRC emacs-lisp
   (use-package sass-mode
      ;; Set Sass mode for SASS files and Css mode for SCSS files.
      :config
      (add-to-list 'auto-mode-alist
     '("\\.sass\\'" . sass-mode)))

   #+END_SRC
** SCSS-mode
   Major mode for SCSS files, together with Sass.
   #+BEGIN_SRC emacs-lisp
   (use-package scss-mode

      :config
      (add-to-list 'auto-mode-alist
     '("\\.scss\\'" . scss-mode)))
   #+END_SRC

** Js2-mode
   A better default Javascript mode
   #+BEGIN_SRC emacs-lisp
   (use-package js2-mode)

   ;; Set js2-mode as default mode for JS files
   (add-to-list 'auto-mode-alist '("\\.js\\'" . js2-mode))

   ;; Set syntax highlight level
   (setq js2-highlight-level 3)
   #+END_SRC
** Highlight-numbers mode
   Sets font lock faces to numbers in Emacs.
   #+BEGIN_SRC emacs-lisp
   (use-package highlight-numbers)
   (add-hook 'prog-mode-hook 'highlight-numbers-mode)
   #+END_SRC
** Web-beautify
   Format HTML/CSS and JS code with js-beautify
   #+BEGIN_SRC emacs-lisp
   (use-package web-beautify)
   #+END_SRC
** Flycheck
   Syntax checker, replaces flymake
   #+BEGIN_SRC emacs-lisp
   (use-package flycheck
      :config
      ;; turn on flychecking globally
      (add-hook 'after-init-hook #'global-flycheck-mode))
   #+END_SRC
** PHP-mode
   PHP support for Emacs.
   #+BEGIN_SRC emacs-lisp
   (use-package php-mode)
   ;; Flymake support for PHP files
   (use-package flymake-php)
   (add-hook 'php-mode-hook 'flymake-php-load)
   #+END_SRC
** Enhanced-ruby-mode
   A better ruby-mode.
   #+BEGIN_SRC emacs-lisp
   (use-package enh-ruby-mode)

   ;; Set it as default mode for Ruby files
   (add-to-list 'auto-mode-alist
       '("\\(?:\\.rb\\|ru\\|rake\\|thor\\|jbuilder\\|gemspec\\|podspec\\|/\\(?:Gem\\|Rake\\|Cap\\|Thor\\|Vagrant\\|Guard\\|Pod\\)file\\)\\'"
       . enh-ruby-mode))
   #+END_SRC
** Ruby Tools
   Goodies for Ruby programming modes.
   #+BEGIN_SRC emacs-lisp
   (use-package ruby-tools)
   #+END_SRC
** Engine mode
   Query search engines from Emacs.
   #+BEGIN_SRC emacs-lisp
   ;; Ensure it's loaded
   (use-package engine-mode)
   ;; Activate it
   (engine-mode t)

   ;; Define search engines to use
   (defengine github
       "https://github.com/search?ref=simplesearch&q=%s"
       :keybinding "g")
   (defengine duckduckgo
       "https://duckduckgo.com/?q=%s"
       :keybinding "d")
   (defengine youtube
       "https://www.youtube.com/results?search_query=%s"
       :keybinding "y")
   (defengine stackoverflow
       "https://stackoverflow.com/search?q=%s"
       :keybinding "s")
   #+END_SRC
** Smart Mode Line
   Prettier mode line.
   #+BEGIN_SRC emacs-lisp
   ;; Smart-mode-line depends on powerline
   (require-package 'powerline)
   (require 'powerline)
   (require-package 'smart-mode-line)

   ;; Activate smart-mode-line
   (setq sml/theme 'powerline)
   (sml/setup)
   #+END_SRC
** Evil Mode
   Yes, I'm committing this heresy
   #+BEGIN_SRC emacs-lisp
   (require-package 'evil)
   (evil-mode 1)

   ;; Load configs
   (load "~/my-dotfiles/.emacs.d/evilrc")
   #+END_SRC
** Web Mode
   I use this for HTML files mostly, works good for PHP too.
   #+BEGIN_SRC emacs-lisp

   (require-package 'web-mode)

   ;; File associations
   (add-to-list 'auto-mode-alist '("\\.phtml\\'" . web-mode))
   (add-to-list 'auto-mode-alist '("\\.php\\'" . web-mode))
   (add-to-list 'auto-mode-alist '("\\.erb\\'" . web-mode))
   (add-to-list 'auto-mode-alist '("\\.djhtml\\'" . web-mode))
   (add-to-list 'auto-mode-alist '("\\.html?\\'" . web-mode))

   ;; Engine associations
   (setq web-mode-engines-alist
       '(("php"    . "\\.phtml\\'")
       ("blade"  . "\\.blade\\."))
   )
   #+END_SRC
** Helm
    Incremental completion and selection narrowing framework
    #+BEGIN_SRC emacs-lisp
    (require-package 'helm)
    (require 'helm-config)
    (helm-mode 1)

    ;; Bind the keys I want:
    (global-set-key (kbd "M-x") 'helm-M-x)
    (global-set-key (kbd "Â»") 'helm-M-x)
    (global-set-key (kbd "C-x C-f") 'helm-find-files)
    (global-set-key (kbd "C-x b") 'helm-buffers-list)

    ;; Complete with tab in Helm buffer, remap action menu to C-tab
    (define-key helm-map (kbd "<tab>") 'hippie-expand)
    (define-key helm-map (kbd "C-<tab>") 'helm--action-prompt)

    ;; Enable fuzzy matching
    (setq helm-M-x-fuzzy-match t)
    #+END_SRC
** Company
   *COMPlete ANYthing* inside Emacs.
   I switched to it because it works in GUI Emacs and auto-complete doesn't.
   #+BEGIN_SRC emacs-lisp
   (require-package 'company)

   ;; Add Tern to Company
   (require-package 'company-tern)
   (require-package 'tern)

   ;; Call that inside js2-mode and add tern to company backends
   (defun tern-mode-tweaks ()
       (add-to-list 'company-backends 'company-tern)
       (tern-mode 1))
   (add-hook 'js2-mode-hook 'tern-mode-tweaks)
   ;; Autocompletion for Bootstrap/FontAwesome classes
   (require-package 'ac-html-bootstrap)

   ;; Web-mode completions
   (require-package 'company-web)

   ;; Add web-mode completions when started
   (require 'company-web-html)

   ;; Company statistics package
   (use-package company-statistics)
   (company-statistics-mode)
   #+END_SRC
** Keyfreq
   Shows most used commands in editing session.
   To see the data, run (keyfreq-show) with M-:
   #+BEGIN_SRC emacs-lisp
   (require-package 'keyfreq)

   ;; Ignore arrow commands and self-insert-commands
   (setq keyfreq-excluded-commands
       '(self-insert-command
       org-self-insert-command
       abort-recursive-edit
       forward-char
       backward-char
       previous-line
       next-line))

   ;; Activate it
   (keyfreq-mode 1)
   (keyfreq-autosave-mode 1)
   #+END_SRC
** Diminish
   Free some space in the mode line removing superfluous mode indications.
   #+BEGIN_SRC emacs-lisp

   (require-package 'diminish)

   ;; Diminish them!
   (diminish 'company-mode)
   (diminish 'editorconfig-mode)
   (diminish 'autopair-mode)
   (diminish 'helm-mode)
   (diminish 'auto-revert-mode)
   #+END_SRC
** Magit
   How to win at Git from Emacs.
   #+BEGIN_SRC emacs-lisp
   (use-package magit)
   #+END_SRC
** Editorconfig
   Helps developers define and maintain consistent coding styles
   between different editors and IDEs.
   #+BEGIN_SRC emacs-lisp
   (use-package editorconfig
      :init
      ;; Activate it.
      (editorconfig-mode 1))
   #+END_SRC
** YAML-mode
   YAML support for Emacs.
   #+BEGIN_SRC emacs-lisp
   (use-package yaml-mode)
   #+END_SRC
** CSV-mode
   CSV support for Emacs.
   #+BEGIN_SRC emacs-lisp
   (use-package csv-mode)
   #+END_SRC
** Nyan-mode
   Put a Nyan Cat in your mode line! :3
   #+BEGIN_SRC emacs-lisp
   (use-package nyan-mode
      :init
      (nyan-mode 1))
   #+END_SRC
** Eshell configurations
   #+BEGIN_SRC emacs-lisp
   ;; Eshell extras
   (use-package eshell-prompt-extras)

   ;; More configs
   (with-eval-after-load "esh-opt"
   (autoload 'epe-theme-lambda "eshell-prompt-extras")
   (setq eshell-highlight-prompt t
       eshell-prompt-function 'epe-theme-lambda))
   #+END_SRC
** Yasnippets
   It originally came with company-mode, it's handy to write faster
   #+BEGIN_SRC emacs-lisp
   (use-package yasnippet-snippets)
   #+END_SRC
** Mode Icons
   Indicate modes in the mode line using icons
   #+BEGIN_SRC emacs-lisp
   (use-package mode-icons
      :init
      (mode-icons-mode))
   #+END_SRC
** Emojify
   Add emoji support for Emacs
   #+BEGIN_SRC emacs-lisp
   (use-package emojify)
   #+END_SRC
** Sort
** Theme Changer
   Change current theme depending on time of the day
   #+BEGIN_SRC emacs-lisp
   (use-package theme-changer
      :config
      (progn ;; Set the location
      (setq calendar-location-name "Curitiba, PR")
      (setq calendar-latitude -25.41)
      (setq calendar-longitude -49.25)

      ;; Specify the day and night themes:
      (change-theme 'whiteboard 'fairyfloss)))
   #+END_SRC
* Themes
** Moe
   Light and dark theme
   #+BEGIN_SRC emacs-lisp
   (use-package moe-theme)
   #+END_SRC

   #+RESULTS:
** Cyberpunk
   Dark, high-contrast theme
   #+BEGIN_SRC emacs-lisp
   (use-package cyberpunk-theme)
   #+END_SRC
* Graphical
#+BEGIN_SRC emacs-lisp
;; Set font in graphical mode
(when (display-graphic-p)
    ;; Use Fantasque Sans Mono when available
    (if (member "Fantasque Sans Mono" (font-family-list))
    (set-frame-font "Fantasque Sans Mono 12")
    '(set-frame-font "Ubuntu Mono 12" nil t))
    ;; Remove menu and scroll bars in graphical mode
    (menu-bar-mode 0)
    (tool-bar-mode 0)
    (scroll-bar-mode 0)
    ;; Enable emoji images
    (global-emojify-mode)
    ;; Maximize frame on startup
    (toggle-frame-maximized))
#+END_SRC
* Keybindings
#+BEGIN_SRC emacs-lisp
;; Remapping the help hotkey so it doesn't clash with Unix backspace.
;; Whenever you want to call help you can use M-x help as well. F1
;; works too.
(define-key key-translation-map [?\C-h] [?\C-?])

;; Unfill region
(define-key global-map "\C-\M-q" 'unfill-region)

;; Kill all the buffers matching the provided regex
(global-set-key [24 75] (quote kill-matching-buffers))

;; Switch to last buffer - I do it all the time
(global-set-key [27 112] (quote mode-line-other-buffer))

;; Mapping AltGr-d to delete-other-windows,
;; Another symbol I don't use often.
(global-set-key [240] (quote delete-other-windows))

;; Map magit-status to C-x g
(global-set-key [24 103] (quote magit-status))

;; Access buffers with Alt-Gr b
(global-set-key [8221] (quote ido-switch-buffer))

;; Map the Home and End keys to go to the beginning and end of the buffer
(global-set-key [home] (quote beginning-of-buffer))
(global-set-key [end] (quote end-of-buffer))

;; Open Emacs config file
;; (find-file "~/.emacs" t)

;; Move to beginning of line or indentation
(defun back-to-indentation-or-beginning () (interactive)
  (if (= (point) (progn (back-to-indentation) (point)))
      (beginning-of-line)))

(global-set-key (kbd "C-a") (quote back-to-indentation-or-beginning))

;; Hippie-Expand: change key to M-SPC; Replace dabbrev-expand
(global-set-key "\M- " 'hippie-expand)
(global-set-key "\M-/" 'hippie-expand)

;; Cmus configurations: use the media keys with it in GUI Emacs
;; Play/pause button

;; Eshell - bind M-p to go back to previous buffer
(defun eshell-tweaks ()
    "Keybindings for the Emacs shell"
    (local-set-key (kbd "M-p") 'switch-to-prev-buffer)
    "Start in Emacs mode"
    (evil-set-initial-state 'eshell-mode 'emacs))
(add-hook 'eshell-mode-hook 'eshell-tweaks)

;; Set C-x j to go to current clocked task in org-mode
(global-set-key (kbd "C-x j") 'org-clock-goto)

#+END_SRC
* Web-mode
#+BEGIN_SRC emacs-lisp
(defun web-mode-keybindings ()
    "Define mode-specific keybindings like this."
    (local-set-key (kbd "C-c C-v") 'browse-url-of-buffer)
    (local-set-key (kbd "C-c /") 'sgml-close-tag))

;; Add company backends when loading web-mode.
(defun web-mode-company-load-backends ()
    (company-web-bootstrap+)
    (company-web-fa+))

(add-hook 'web-mode-hook 'web-mode-keybindings)
(add-hook 'web-mode-hook 'web-mode-company-load-backends)
#+END_SRC
* Org-mode
#+BEGIN_SRC emacs-lisp
;; We don't need Flycheck in org-mode buffers. Usually.
(add-hook 'org-mode-hook '(lambda() (flycheck-mode 0)))

;; Bind org-capture to C-c c
(global-set-key (kbd "\C-c c") (quote org-capture))

;; Bind org-pomodoro to C-x p
(global-set-key (kbd "\C-x p") (quote org-pomodoro))

;; Open the agenda with C-c a
(global-set-key [3 97] (quote org-agenda))

;; Open subheading with C-c RET and invert with M-RET
(local-set-key [27 13] (quote org-ctrl-c-ret))
(local-set-key [3 13] (quote org-insert-subheading))

;; Org-agenda: point the files you want it to read
;; (setq org-agenda-files (list "~/file-bouncer/org-files/contact-based-system/"))

;; Always respect the content of a heading when creating todos!
(local-set-key [M-S-return] (quote org-insert-todo-heading-respect-content))

;; Map C-S-enter to org-insert-todo-subheading
(local-set-key [C-S-return] (quote org-insert-todo-subheading))
#+END_SRC
** Org-bullets
   Change org-mode's *s to UTF-8 chars
   #+BEGIN_SRC emacs-lisp
   (use-package org-bullets
      :init
      (add-hook 'org-mode-hook (lambda() (org-bullets-mode 1))))
   #+END_SRC
* Random
#+BEGIN_SRC emacs-lisp
;; Enh-ruby-mode: Run buffer in inf-ruby process
(add-hook 'enh-ruby-mode-hook
  '(lambda ()
     (local-set-key [3 3] (quote ruby-send-buffer))))

;; Python-mode: Send buffer to python shell
(local-set-key [3 2] (quote python-shell-send-buffer))

;; Elisp-mode: Eval-buffer with C-c C-c
(add-hook 'emacs-lisp-mode-hook
  '(lambda ()
     (local-set-key "\C-c \C-c" (quote eval-buffer))))

;; SGML mode (AKA HTML mode) - Open buffer in browser
(add-hook 'sgml-mode-hook
  '(lambda ()
     (local-set-key "\C-c \C-o" (quote browse-url-of-buffer))))
#+END_SRC
* Variables
#+BEGIN_SRC emacs-lisp
;; Set Org mode as default mode for new buffers:
(setq-default major-mode 'org-mode)

;; Enable auto-fill mode by default
(auto-fill-mode 1)

;; Set default fill to 79
(set-fill-column 79)

;; Set line number mode and column number mode for code files
(line-number-mode 1)

;; Change tab width and change tabs to spaces
(setq-default tab-width 4)
(setq-default indent-tabs-mode nil)

;; Making Emacs auto-indent
(define-key global-map (kbd "RET") 'newline-and-indent)

;; Shows trailing whitespace, if any:
(setq-default show-trailing-whitespace t)
;; Don't do that for terminal mode!
(add-hook 'multi-term-mode-hook (setq-default show-trailing-whitespace nil))

;; Python indentation
(setq python-indent 4)

(defun css-mode-tweaks()
  (emmet-mode 1)
  (rainbow-mode 1))

;; Emmet-mode: activate for html-mode, sgml-mode,
;; css-mode, web-mode and sass-mode
(add-hook 'sgml-mode-hook 'emmet-mode)
(add-hook 'sass-mode-hook 'css-mode-tweaks)
(add-hook 'web-mode-hook 'emmet-mode)

;; By the way, it's nice to add rainbow-mode for CSS
(add-hook 'css-mode-hook 'css-mode-tweaks)

;; Python: use python3 as default shell interpreter
(setq python-shell-interpreter "python3")

#+END_SRC
* Macros
#+BEGIN_SRC emacs-lisp
;; To save a macro, record it with C-x ( (start) and C-x ) (stop),
;; give it a name with C-x C-k n (C-k is for maKro) and
;; insert it in this file with insert-kbd-macro.
;; Then you execute it mapping it to a key! ðŸ˜Š

;; Example macro: Mark todos as done
(fset 'org-mark-as-done
   (lambda (&optional arg) "Keyboard macro." (interactive "p") (kmacro-exec-ring-item (quote ("d" 0 "%d")) arg)))
#+END_SRC
* Twittering mode
  Use Twitter from within Emacs!
  #+BEGIN_SRC emacs-lisp
  (use-package twittering-mode
      :config
      (
    ;; Adjust update interval in seconds. It's timeR, not time!
    (setq twittering-timer-interval 3600)

    ;; Display icons (if applicable)
    (setq twittering-icon-mode t)

    ;; Use a master password so you don't have to ask for authentication every time
    (setq twittering-use-master-password t))
      :bind-keymap
      (
    ("C-c r" . twittering-reply-to-user)
    ("C-c f" . twittering-favorite)
    ("C-c n" . twittering-native-retweet)))
  #+END_SRC

  #+RESULTS:
* Packages saved for later need
** Perspective
# ** Perspective
#    Switch between named "perspectives" of the editor.
#    #+BEGIN_SRC emacs-lisp
#    (use-package perspective)
#    (persp-mode)
#    #+END_SRC
